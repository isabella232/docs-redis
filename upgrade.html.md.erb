---
title: Upgrading Redis for PCF
owner: London Services
---

<strong><%= modified_date %></strong>

This section contains the upgrade procedure and upgrade paths for Redis for PCF.

## <a id="upgrading"></a>Compatible Upgrade Paths ##

Before upgrading Redis for PCF, for compatibility information, see the [Product Version Matrix](http://docs.pivotal.io/compatibility-matrix.pdf).

## <a id="upgrades"></a>Upgrade Redis for PCF ##

This product enables a reliable upgrade experience between versions of the product that is deployed through Ops Manager.

For information on the upgrade paths for each released version, see the above table.

To upgrade Redis for PCF, do the following:

1. Download the latest version of the product from [Pivotal Network](https://network.pivotal.io/products/p-redis).
1. Upload the new `.pivotal` file to Ops Manager.
1. If required, upload the stemcell associated with the update.
1. If required, update any new mandatory configuration parameters.
1. Click **Apply changes**. The rest of the process is automated.

During the upgrade deployment, each Redis instance experiences a small period of downtime as each Redis instance is updated with the new software components. This downtime is because the Redis instances are single VMs operating in a non HA setup.

The length of the downtime depends on whether there is a stemcell update to replace the operating system image, or whether the existing VM can simply have the redis software updated. Stemcell updates incur additional downtime while the IaaS creates the new VM, whereas updates without a stemcell update are faster.

Ops Manager ensures the instances are updated with the new packages and any configuration changes are applied automatically.

Upgrading to a newer version of the product does not cause any loss of data or configuration.

## <a id="downtime"></a> Downtime During Upgrades and Redeploys ##

A redeploy causes downtime of the Redis for PCF tile.
This section clarifies what events trigger a redeploy.

### <a id="opsman"></a> Ops Manager Changes ###

In Ops Manager, any field that changes the manifest causes a redeploy of the Redis for PCF tile.

### <a id="pas"></a> PAS (or Elastic Runtime) Changes ###

In Pivotal Application Service (PAS) or Elastic Runtime, changes to any of the following properties can trigger downtime:

* `..cf.consul_server.ips`: Consul Server Resource Config
* `$runtime.system_domain`: Runtime System Domain
* `..cf.ha_proxy.skip_cert_verify.value`: Disable SSL certificate validation for this environment in PAS or Elastic Runtime
* `$runtime.apps_domain`: Runtime Apps Domain
* `..cf.nats.ips`: NATS Resource Config
* `$self.service_network`: Service Network in Ops Manager

When the operator applies any of the above changes to PAS or Elastic Runtime, downtime is triggered
for the following:

* Redis On-Demand Broker in Redis for PCF v1.8 and later
* Dedicated-VM and Shared-VM Services in Redis for PVF v1.9 and earlier

## <a id="all-instances"></a> Upgrading All Service Instances ##

* For Redis for PCF v1.8 and later, downtime for service instances occurs only after the operator
runs the `upgrade-all-service-instances` BOSH errand, after all tile upgrades are completed
successfully.

* Any change to a field on the Redis for PCF tile causes BOSH to redeploy both the legacy and the
on-demand Redis Brokers after the operator runs the `upgrade-all-service-instances` BOSH errand.

## <a id="network-upgrades"></a> Network Changes After Deployment ##

This section explains how changing the network after deploying Redis for PCF affects instances and
apps.

### <a id="network-upgrades-dedicated-shared-vms"></a> Dedicated and Shared VMs ###

To change the network for dedicated-VM and shared-VM services, click **Assign AZs and Networks** in
the Redis for PCF tile configuration and use the **Network** dropdown. The network applies to both
shared-VM and dedicated-VM services.

You can also change the network by altering the CIDR in the Ops Manager Director tile.

Pivotal discourages changing the network that a pre-existing dedicated-VM or shared-VM deployment
works with.

If the network is changed, app bindings for existing dedicated-VM and shared-VM instances might
stop working. Dedicated-VMs might also be reallocated as new service instances without their data
being cleared, resulting in a data leak between apps.

### <a id="network-upgrades-on-demand"></a> On-Demand Service Instances ###

To change the service network for on-demand service instances, click **Assign AZs and Networks** in
the Redis tile configuration and use the **Service Network** dropdown. The service network applies
to on-demand service instances.

You can also change the service network by altering the CIDR in the Ops Manager Director tile.

If you change the service network, you must unbind and rebind existing apps to the on-demand Redis
instance.

New on-demand service instances are placed into the new service network, but existing on-demand
service instances are not moved. If you need to move the data in on-demand Redis instances to a new
service network, you must create a new instance. migrate the data manually, and delete the old
instance.

Similarly, changing the availability zone for an on-demand plan only applies to new on-demand
instances and does not alter existing instances.

## <a id="policy"></a> Release Policy ##

When a new version of Redis is released, Pivotal aims to release a new version of Redis for PCF
containing the new Redis version soon after.

When a new version of Redis or another dependent software component, such as the stemcell, is
released due to a critical CVE, Pivotal's goal is to release a new version of the Redis for PCF
within 48 hours.
